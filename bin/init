#!/bin/bash

export CS132_ENV_ARCH="$(uname -m)"
export CS132_ENV_MOUNT_DIR="$(realpath "${1:-.}")"
export CS132_ENV_BIN_DIR="$(dirname "$(realpath "bin/init")")"


echo "Detecting architecture..."
echo "Found $CS132_ENV_ARCH"

echo "Prepending $CS132_ENV_BIN_DIR to \$PATH..."
echo
export PATH="$CS132_ENV_BIN_DIR:$PATH"
echo "\$PATH is now $PATH"
echo

echo "Mounting '$CS132_ENV_MOUNT_DIR' to '/cs132'..."

echo "============================"
echo "Starting docker container..."
echo "============================"
echo $(cd "$CS132_ENV_BIN_DIR/docker" && docker compose up -d)

echo "* To stop the container, run"
echo "      cmd stop"
echo
echo "* To remove the container, run"
echo "      source cmd remove"
