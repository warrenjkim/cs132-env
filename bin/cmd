#!/bin/bash

CONTAINER_NAME=cs132-env
CMD=$(echo $1 | tr '[:upper:]' '[:lower:]')
HW=$2

if [[ "$CMD" == "start" ]]; then
    (cd "$CS132_ENV_BIN_DIR/docker" && docker compose up -d)

elif [[ "$CMD" == "stop" ]]; then
    (cd "$CS132_ENV_BIN_DIR/docker" && docker compose stop -t 0)

elif [[ "$CMD" == "remove" ]]; then
    (cd "$CS132_ENV_BIN_DIR/docker" && docker compose down -v -t 0)
    echo "Removing $CS132_ENV_BIN_DIR from \$PATH..."
    export PATH="$(echo $PATH | sed -E "s|${CS132_ENV_BIN_DIR}:||g")"
    echo
    echo "\$PATH is now $PATH"

    echo
    echo "Unsetting \$CS132_ENV_ARCH..."
    unset CS132_ENV_ARCH

    echo "Unsetting \$CS132_ENV_BIN_DIR..."
    unset CS132_ENV_BIN_DIR

    echo "Unsetting \$CS132_ENV_MOUNT_DIR..."
    unset CS132_ENV_MOUNT_DIR

else
    (cd "$CS132_ENV_BIN_DIR/docker" && docker compose exec $CONTAINER_NAME bash -c "gradle --version")
    echo
    (cd "$CS132_ENV_BIN_DIR/docker" && docker compose exec $CONTAINER_NAME bash -c "cd ./${HW} && gradle ${CMD}")
fi
